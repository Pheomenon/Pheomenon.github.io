<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Docker基础知识汇编 | XonLab</title><meta name="description" content="容器技术概述容器化技术的由来 容器是一种基础工具。泛指任何可以用于容纳其它物品的工具，可以部分或完全封闭，被用于容纳、储存、运输物品。物体可以被放置在容器中，而容器则可以保护内容物。 容器的类型：瓶、罐、箱、篮、桶、袋、瓮、碗、柜、盆、鞘 …  把系统里的三个服务拆分开，借助容器运行互不干扰。   容器发展的历史容器概念始于 1979 年提出的 UNIX chroot，它是一个 UNIX 操作系统"><meta name="keywords" content="Docker,Kubernetes"><meta name="author" content="PhenoGao"><meta name="copyright" content="PhenoGao"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://xonlab.com/2020/03/26/Docker%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%B1%87%E7%BC%96/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="Docker基础知识汇编"><meta property="og:url" content="http://xonlab.com/2020/03/26/Docker%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%B1%87%E7%BC%96/"><meta property="og:site_name" content="XonLab"><meta property="og:description" content="容器技术概述容器化技术的由来 容器是一种基础工具。泛指任何可以用于容纳其它物品的工具，可以部分或完全封闭，被用于容纳、储存、运输物品。物体可以被放置在容器中，而容器则可以保护内容物。 容器的类型：瓶、罐、箱、篮、桶、袋、瓮、碗、柜、盆、鞘 …  把系统里的三个服务拆分开，借助容器运行互不干扰。   容器发展的历史容器概念始于 1979 年提出的 UNIX chroot，它是一个 UNIX 操作系统"><meta property="og:image" content="https://edu-102.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%B0%81%E9%9D%A2/pexels-jo%C3%A3o-v%C3%ADtor-heinrichs-1856183.jpg"><meta property="article:published_time" content="2020-03-26T08:07:21.000Z"><meta property="article:modified_time" content="2021-02-07T10:14:26.589Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="prev" title="Kubernetes部署 Ⅰ" href="http://xonlab.com/2020/03/28/Kubernetes%E9%83%A8%E7%BD%B2%E2%85%A0/"><link rel="next" title="《少有人走的路》第4章" href="http://xonlab.com/2020/03/22/%E3%80%8A%E5%B0%91%E6%9C%89%E4%BA%BA%E8%B5%B0%E7%9A%84%E8%B7%AF%E3%80%8B%E7%AC%AC4%E7%AB%A0/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false    
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true
  }</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.1"></head><body><canvas class="fireworks"></canvas><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://edu-102.oss-cn-beijing.aliyuncs.com/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">105</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">68</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">7</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#容器技术概述"><span class="toc-number">1.</span> <span class="toc-text">容器技术概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#容器化技术的由来"><span class="toc-number">1.1.</span> <span class="toc-text">容器化技术的由来</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#容器发展的历史"><span class="toc-number">1.2.</span> <span class="toc-text">容器发展的历史</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker的诞生和幕后的公司"><span class="toc-number">1.3.</span> <span class="toc-text">Docker的诞生和幕后的公司</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是docker？"><span class="toc-number">1.4.</span> <span class="toc-text">什么是docker？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用docker的优势"><span class="toc-number">1.5.</span> <span class="toc-text">使用docker的优势</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker容器引擎介绍"><span class="toc-number">1.6.</span> <span class="toc-text">Docker容器引擎介绍</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker容器引擎的安装部署"><span class="toc-number">2.</span> <span class="toc-text">Docker容器引擎的安装部署</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#基础环境检查"><span class="toc-number">2.1.</span> <span class="toc-text">基础环境检查</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装epel源"><span class="toc-number">2.2.</span> <span class="toc-text">安装epel源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装官方docker源"><span class="toc-number">2.3.</span> <span class="toc-text">安装官方docker源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装最新版docker并配置"><span class="toc-number">2.4.</span> <span class="toc-text">安装最新版docker并配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#启动docker"><span class="toc-number">2.5.</span> <span class="toc-text">启动docker</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#核查docker配置及启动情况"><span class="toc-number">2.6.</span> <span class="toc-text">核查docker配置及启动情况</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#启动第一个Docker容器"><span class="toc-number">2.7.</span> <span class="toc-text">启动第一个Docker容器</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker的镜像管理"><span class="toc-number">3.</span> <span class="toc-text">Docker的镜像管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#hub-docker-com"><span class="toc-number">3.1.</span> <span class="toc-text">hub.docker.com</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#注册一个dockerhub账号"><span class="toc-number">3.2.</span> <span class="toc-text">注册一个dockerhub账号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#搜索一个镜像"><span class="toc-number">3.3.</span> <span class="toc-text">搜索一个镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#下载一个镜像"><span class="toc-number">3.4.</span> <span class="toc-text">下载一个镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#查看本地镜像"><span class="toc-number">3.5.</span> <span class="toc-text">查看本地镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#给镜像打标签"><span class="toc-number">3.6.</span> <span class="toc-text">给镜像打标签</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#推送镜像"><span class="toc-number">3.7.</span> <span class="toc-text">推送镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#给镜像再打一个标签"><span class="toc-number">3.8.</span> <span class="toc-text">给镜像再打一个标签</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#再次推送镜像"><span class="toc-number">3.9.</span> <span class="toc-text">再次推送镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#删除镜像"><span class="toc-number">3.10.</span> <span class="toc-text">删除镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-镜像新特性"><span class="toc-number">3.11.</span> <span class="toc-text">Docker 镜像新特性</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker的基本操作"><span class="toc-number">4.</span> <span class="toc-text">Docker的基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#启动容器（运行镜像）"><span class="toc-number">4.1.</span> <span class="toc-text">启动容器（运行镜像）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#进入容器"><span class="toc-number">4.2.</span> <span class="toc-text">进入容器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#停止-启动-重启容器"><span class="toc-number">4.3.</span> <span class="toc-text">停止&#x2F;启动&#x2F;重启容器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#删除容器"><span class="toc-number">4.4.</span> <span class="toc-text">删除容器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#修改-提交容器"><span class="toc-number">4.5.</span> <span class="toc-text">修改&#x2F;提交容器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#导出-导入容器"><span class="toc-number">4.6.</span> <span class="toc-text">导出&#x2F;导入容器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#查看容器日志"><span class="toc-number">4.7.</span> <span class="toc-text">查看容器日志</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker的高级操作"><span class="toc-number">5.</span> <span class="toc-text">Docker的高级操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#下载nginx镜像"><span class="toc-number">5.1.</span> <span class="toc-text">下载nginx镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#映射端口"><span class="toc-number">5.2.</span> <span class="toc-text">映射端口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#挂载数据卷"><span class="toc-number">5.3.</span> <span class="toc-text">挂载数据卷</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#传递环境变量"><span class="toc-number">5.4.</span> <span class="toc-text">传递环境变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#容器内安装软件（工具）"><span class="toc-number">5.5.</span> <span class="toc-text">容器内安装软件（工具）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#容器的生命周期"><span class="toc-number">5.6.</span> <span class="toc-text">容器的生命周期</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker-file详解"><span class="toc-number">6.</span> <span class="toc-text">Docker file详解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-file介绍"><span class="toc-number">6.1.</span> <span class="toc-text">Docker file介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#USER-WORKDIR指令"><span class="toc-number">6.2.</span> <span class="toc-text">USER&#x2F;WORKDIR指令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ADD-EXPOSE指令"><span class="toc-number">6.3.</span> <span class="toc-text">ADD&#x2F;EXPOSE指令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RUN-ENV指令"><span class="toc-number">6.4.</span> <span class="toc-text">RUN&#x2F;ENV指令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CMD-ENTRYPOINT指令"><span class="toc-number">6.5.</span> <span class="toc-text">CMD&#x2F;ENTRYPOINT指令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CMD指令"><span class="toc-number">6.5.1.</span> <span class="toc-text">CMD指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ENTRYPOINT指令"><span class="toc-number">6.5.2.</span> <span class="toc-text">ENTRYPOINT指令</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker的网络模型"><span class="toc-number">7.</span> <span class="toc-text">Docker的网络模型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#NAT-默认"><span class="toc-number">7.1.</span> <span class="toc-text">NAT(默认)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#None"><span class="toc-number">7.2.</span> <span class="toc-text">None</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Host"><span class="toc-number">7.3.</span> <span class="toc-text">Host</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#联合网络"><span class="toc-number">7.4.</span> <span class="toc-text">联合网络*</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#额外一点内容"><span class="toc-number">8.</span> <span class="toc-text">额外一点内容</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#快速更改密码"><span class="toc-number">8.1.</span> <span class="toc-text">快速更改密码</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://edu-102.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%B0%81%E9%9D%A2/pexels-jo%C3%A3o-v%C3%ADtor-heinrichs-1856183.jpg)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">XonLab</a></span><span class="pull-right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">Docker基础知识汇编</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date" title="发表于 2020-03-26 16:07:21"><i class="fa-fw far fa-calendar-alt"></i> 发表于 2020-03-26</time></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta__icon"></i><span>字数总计:</span><span class="word-count">7.6k</span><span class="post-meta__separator">|</span><i class="far fa-clock fa-fw post-meta__icon"></i><span>阅读时长: 38 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="far fa-eye fa-fw post-meta__icon"></i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="容器技术概述"><a href="#容器技术概述" class="headerlink" title="容器技术概述"></a>容器技术概述</h1><h2 id="容器化技术的由来"><a href="#容器化技术的由来" class="headerlink" title="容器化技术的由来"></a>容器化技术的由来</h2><blockquote>
<p>容器是一种基础工具。泛指任何可以用于容纳其它物品的工具，可以部分或完全封闭，被用于容纳、储存、运输物品。物体可以被放置在容器中，而容器则可以保护内容物。</p>
<p>容器的类型：<br>瓶、罐、箱、篮、桶、袋、瓮、碗、柜、盆、鞘 …</p>
</blockquote>
<p>把系统里的三个服务拆分开，借助容器运行互不干扰。</p>
<img src = "/images/m_eaa33ca0f7f960412b13a5ce47d2303b_r.png">

<h2 id="容器发展的历史"><a href="#容器发展的历史" class="headerlink" title="容器发展的历史"></a>容器发展的历史</h2><p>容器概念始于 1979 年提出的 UNIX chroot，它是一个 UNIX 操作系统的系统调用，将一个进程及其子进程的根目录改变到文件系统中的一个新位置，让这些进程只能访问到这个新的位置，从而达到了进程隔离的目的。</p>
<img src = "/images/m_e451aa3e2ed85977f816c2ad8e02af43_r.png">

<p>2000 年的时候 FreeBSD 开发了一个类似于 chroot 的容器技术 Jails，这是最早期，也是功能最多的容器技术。Jails 英译过来是监狱的意思，这个“监狱”（用沙盒更为准确）包含了文件系统、用户、网络、进程等的隔离。</p>
<p>2001 Linux 也发布自己的容器技术 Linux Virtual Server，2004 Solaris 也发布了 Solaris Containers，两者都将资源进行划分，形成一个个 zones，又叫做虚拟服务器。</p>
<p>2005 年推出 OpenVZ，它通过对 Linux 内核进行补丁来提供虚拟化的支持，每个 OpenVZ 容器完整支持了文件系统、用户及用户组、进程、网络、设备和 IPC 对象的隔离。</p>
<p>2007 年 Google 实现了 Control Groups( cgroups )，并加入到 Linux 内核中，这是划时代的，为后期容器的资源配额提供了技术保障。</p>
<p>2008 年基于 cgroups 和 linux namespace 推出了第一个最为完善的 Linux 容器 LXC。</p>
<p>2013 年推出到现在为止最为流行和使用最广泛的容器 Docker，相比其他早期的容器技术，Docker 引入了一整套容器管理的生态系统，包括分层的镜像模型，容器注册库，友好的 Rest API。</p>
<p>2014 年 CoreOS 也推出了一个类似于 Docker 的容器 Rocket，CoreOS 一个更加轻量级的 Linux 操作系统，在安全性上比 Docker 更严格。</p>
<p>2016 年微软也在 Windows 上提供了容器的支持，Docker 可以以原生方式运行在 Windows 上，而不是需要使用 Linux 虚拟机。</p>
<p>基本上到这个时间节点，容器技术就已经很成熟了，再往后就是容器云的发展，由此也衍生出多种容器云的平台管理技术，其中以 kubernetes 最为出众，有了这样一些细粒度的容器集群管理技术，也为微服务的发展奠定了基石。因此，对于未来来说，应用的微服务化是一个较大的趋势。</p>
<h2 id="Docker的诞生和幕后的公司"><a href="#Docker的诞生和幕后的公司" class="headerlink" title="Docker的诞生和幕后的公司"></a>Docker的诞生和幕后的公司</h2><p>2010年，几个大胡子年轻人在旧金山成立了一家做PaaS平台的公司，起名为dotCloud，dotCloud主要是基于PaaS平台为开发者或开发商提供技术服务。</p>
<p>Docker于2013.03.27正式作为public项目发布。</p>
<p>DotCloud公司2013年10月改名为Docker Inc，转型专注于Docker引擎和Docker生态系统。</p>
<p>落腮胡，皮夹克和摩托车，是Docker的灵魂人物CTO Solomon Hykeys的标准记号，外形看起来像是推动社会运动的老大。</p>
<img src = "/images/m_644f1e6b4ea79fd4b329d02c479998cf_r.png">

<p>Docker 容器的思想就是采用集装箱思想，为应用提供了一个基于容器的标准化运输系统。Docker 可以将任何应用及其依赖打包成一个轻量级、可移植、自包含的容器。容器可以运行在几乎所有的操作系统上。这样容器就可以跑在任何环境中，因此才有了那句话：</p>
<blockquote>
<p>Build Once, Run Anywhere</p>
</blockquote>
<h2 id="什么是docker？"><a href="#什么是docker？" class="headerlink" title="什么是docker？"></a>什么是docker？</h2><p>Docker是Docker.inc公司开源的一个基于LXC技术之上构建的Container容器引擎，源代码托管在GitHub上，基于Go语言并遵从Apache2.0协议开源（可以商业）。</p>
<p>Docker项目的目标是实现轻量级的操作系统虚拟化解决方案。</p>
<p>Docker是容器引擎，Docker是通过内核虚拟化技术（namespaces及cgroups等）来提供容器的资源隔离与安全保障等。由于Docker通过操作系统层的虚拟化实现隔离，所以Docker容器在运行时，不需要类似虚拟机VM额外的操作系统开销，提高资源利用率。</p>
<p>微软，红帽Linux，IBM，Oracle等主流IT厂商已经在自己的产品里增加了对Docker的支持。</p>
<p>相比其他早期的容器技术，Docker引入了一整套容器管理的生态系统，包括分层的镜像模型，容器注册库，友好Rest API。</p>
<p>下面图比较了Docker和传统虚拟化方式的不同之处，可见容器是在操作系统层面上实现虚拟化，直接复制本地主机的操作系统，而传统方式则是在硬件层面实现。</p>
<img src = "/images/m_01695e3d340b880de53c321ca0458677_r.png">

<p>为了用docker容器模型，应用A和应用B在哪些层面上<a href="https://www.cnblogs.com/rdchenxi/p/10455831.html" target="_blank" rel="noopener">隔离</a>呢？</p>
<img src = "/images/m_9dac59255d7815e9f010c612b6bb148a_r.png">

<h2 id="使用docker的优势"><a href="#使用docker的优势" class="headerlink" title="使用docker的优势"></a>使用docker的优势</h2><img src = "/images/m_8d9d11aed21823a5e0185845c2676475_r.png">

<img src = "/images/m_7127665b1220ebf62118e95f5d53c101_r.png">

<h2 id="Docker容器引擎介绍"><a href="#Docker容器引擎介绍" class="headerlink" title="Docker容器引擎介绍"></a>Docker容器引擎介绍</h2><p>Docker引擎可以从Docker网站下载，也可以基于Github上的源码进行构建。无论是开源版本还是商业版本，都有Linux和windows版本。</p>
<p>Docker引擎主要有两个版本：企业版（EE）和社区版（CE）。</p>
<p>每个季度，企业版和社区版都会发布一个稳定版本。社区版本会提供4个月的支持，而企业版本会提供12个月的支持。</p>
<p>从2017年第一季度开始，Docker版本号遵循YY.MM-xx格式，类似于Ubuntu等项目。例如，2018年6月第一次发布的社区版为18.06.0-ce。</p>
<p>注：2017年第一季度以前，Docker版本号遵循大版本号.小版本号的格式。采用新格式前的最后一个版本是Docker1.13。</p>
<h1 id="Docker容器引擎的安装部署"><a href="#Docker容器引擎的安装部署" class="headerlink" title="Docker容器引擎的安装部署"></a>Docker容器引擎的安装部署</h1><h2 id="基础环境检查"><a href="#基础环境检查" class="headerlink" title="基础环境检查"></a>基础环境检查</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# uname -a</span><br><span class="line">Linux node4.98yz.cn 3.10.0-693.21.1.el7.x86_64 #1 SMP Wed Mar 7 19:03:37 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="line">[root@node4 ~]# cat /etc/redhat-release </span><br><span class="line">CentOS Linux release 7.4.1708 (Core) </span><br><span class="line">[root@node4 ~]# getenforce </span><br><span class="line">Disabled</span><br><span class="line">[root@node4 ~]# systemctl stop firewalld</span><br><span class="line">[root@node4 ~]# free -m</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           5806         135        5526           8         144        5459</span><br><span class="line">Swap:          1023           0        1023</span><br><span class="line">[root@node4 ~]# ping baidu.com</span><br><span class="line">PING baidu.com (220.181.38.148) 56(84) bytes of data.</span><br><span class="line">64 bytes from 220.181.38.148 (220.181.38.148): icmp_seq=1 ttl=51 time=92.4 ms</span><br><span class="line">64 bytes from 220.181.38.148 (220.181.38.148): icmp_seq=2 ttl=51 time=42.5 ms</span><br></pre></td></tr></table></figure>

<h2 id="安装epel源"><a href="#安装epel源" class="headerlink" title="安装epel源"></a>安装epel源</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# yum install epel-release -y</span><br></pre></td></tr></table></figure>

<p>这里可以看到epel源里也有docker1.13.1</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# yum list docker --show-duplicates</span><br><span class="line">Loaded plugins: fastestmirror, langpacks</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirrors.aliyun.com</span><br><span class="line"> * epel: mirrors.aliyun.com</span><br><span class="line"> * extras: mirrors.aliyun.com</span><br><span class="line"> * updates: mirrors.aliyun.com</span><br><span class="line">Available Packages</span><br><span class="line">docker.x86_64                           2:1.13.1-102.git7f2769b.el7.centos                           extras</span><br><span class="line">docker.x86_64                           2:1.13.1-103.git7f2769b.el7.centos                           extras</span><br></pre></td></tr></table></figure>

<h2 id="安装官方docker源"><a href="#安装官方docker源" class="headerlink" title="安装官方docker源"></a>安装官方docker源</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# yum install yum-utils -y</span><br><span class="line">[root@node4 ~]# yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>

<p>这里可以看到docker-ce源里的docker镜像了。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# yum list docker-ce --show-duplicates</span><br><span class="line">Loaded plugins: fastestmirror, langpacks</span><br><span class="line">docker-ce-stable                                                                                              | 3.5 kB  00:00:00     </span><br><span class="line">(1/2): docker-ce-stable/x86_64/updateinfo                                                                     |   55 B  00:00:05     </span><br><span class="line">(2/2): docker-ce-stable/x86_64/primary_db                                                                     |  37 kB  00:00:05     </span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirrors.aliyun.com</span><br><span class="line"> * epel: mirrors.aliyun.com</span><br><span class="line"> * extras: mirrors.aliyun.com</span><br><span class="line"> * updates: mirrors.aliyun.com</span><br><span class="line">Available Packages</span><br><span class="line">docker-ce.x86_64               17.03.0.ce-1.el7.centos                       docker-ce-stable</span><br><span class="line">docker-ce.x86_64               17.03.1.ce-1.el7.centos                       docker-ce-stable</span><br><span class="line">docker-ce.x86_64               17.03.2.ce-1.el7.centos                       docker-ce-stable</span><br><span class="line">docker-ce.x86_64               17.03.3.ce-1.el7                              docker-ce-stable</span><br><span class="line">docker-ce.x86_64               17.06.0.ce-1.el7.centos                       docker-ce-stable</span><br><span class="line">docker-ce.x86_64               17.06.1.ce-1.el7.centos                       docker-ce-stable</span><br><span class="line">docker-ce.x86_64               17.06.2.ce-1.el7.centos                       docker-ce-stable</span><br><span class="line">docker-ce.x86_64               17.09.0.ce-1.el7.centos                       docker-ce-stable</span><br><span class="line">docker-ce.x86_64               17.09.1.ce-1.el7.centos                       docker-ce-stable</span><br><span class="line">docker-ce.x86_64               17.12.0.ce-1.el7.centos                       docker-ce-stable</span><br><span class="line">docker-ce.x86_64               17.12.1.ce-1.el7.centos                       docker-ce-stable</span><br><span class="line">docker-ce.x86_64               18.03.0.ce-1.el7.centos                       docker-ce-stable</span><br><span class="line">docker-ce.x86_64               18.03.1.ce-1.el7.centos                       docker-ce-stable</span><br><span class="line">docker-ce.x86_64               18.06.0.ce-3.el7                              docker-ce-stable</span><br><span class="line">docker-ce.x86_64               18.06.1.ce-3.el7                              docker-ce-stable</span><br><span class="line">docker-ce.x86_64               18.06.2.ce-3.el7                              docker-ce-stable</span><br><span class="line">docker-ce.x86_64               18.06.3.ce-3.el7                              docker-ce-stable</span><br><span class="line">docker-ce.x86_64               3:18.09.0-3.el7                               docker-ce-stable</span><br><span class="line">docker-ce.x86_64               3:18.09.1-3.el7                               docker-ce-stable</span><br><span class="line">docker-ce.x86_64               3:18.09.2-3.el7                               docker-ce-stable</span><br><span class="line">docker-ce.x86_64               3:18.09.3-3.el7                               docker-ce-stable</span><br><span class="line">docker-ce.x86_64               3:18.09.4-3.el7                               docker-ce-stable</span><br><span class="line">docker-ce.x86_64               3:18.09.5-3.el7                               docker-ce-stable</span><br><span class="line">docker-ce.x86_64               3:18.09.6-3.el7                               docker-ce-stable</span><br><span class="line">docker-ce.x86_64               3:18.09.7-3.el7                               docker-ce-stable</span><br><span class="line">docker-ce.x86_64               3:18.09.8-3.el7                               docker-ce-stable</span><br><span class="line">docker-ce.x86_64               3:18.09.9-3.el7                               docker-ce-stable</span><br><span class="line">docker-ce.x86_64               3:19.03.0-3.el7                               docker-ce-stable</span><br><span class="line">docker-ce.x86_64               3:19.03.1-3.el7                               docker-ce-stable</span><br><span class="line">docker-ce.x86_64               3:19.03.2-3.el7                               docker-ce-stable</span><br><span class="line">docker-ce.x86_64               3:19.03.3-3.el7                               docker-ce-stable</span><br><span class="line">docker-ce.x86_64               3:19.03.4-3.el7                               docker-ce-stable</span><br></pre></td></tr></table></figure>

<h2 id="安装最新版docker并配置"><a href="#安装最新版docker并配置" class="headerlink" title="安装最新版docker并配置"></a>安装最新版docker并配置</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# yum install docker-ce -y</span><br><span class="line"></span><br><span class="line">[root@node4 ~]# mkdir /etc/docker</span><br><span class="line">[root@node4 ~]# cd /etc/docker/</span><br><span class="line">[root@node4 docker]# vi /etc/docker/daemon.json</span><br><span class="line">[root@node4 docker]# cat /etc/docker/daemon.json </span><br><span class="line">&#123;</span><br><span class="line">  "graph": "/data/docker",     # docker工作目录</span><br><span class="line">  "storage-driver": "overlay2",   # 存储驱动</span><br><span class="line">  "insecure-registries": ["registry.access.redhat.com","quay.io"],  # 不安全的仓库</span><br><span class="line">  "registry-mirrors": ["https://q2gr04ke.mirror.aliyuncs.com"],  # 加速镜像</span><br><span class="line">  "bip": "172.6.244.1/24",   # docker的网络,尽量要与宿主机有个对照关系</span><br><span class="line">  "exec-opts": ["native.cgroupdriver=systemd"],  # cgroup的类型</span><br><span class="line">  "live-restore": true  # 让docker容器不依懒docker引擎的死与活</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="启动docker"><a href="#启动docker" class="headerlink" title="启动docker"></a>启动docker</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 docker]# systemctl enable docker.service </span><br><span class="line">[root@node4 docker]# systemctl start docker.service </span><br><span class="line"></span><br><span class="line">[root@node4 ~]# docker version</span><br><span class="line">Client: Docker Engine - Community</span><br><span class="line"> Version:           19.03.4</span><br><span class="line"> API version:       1.40</span><br><span class="line"> Go version:        go1.12.10</span><br><span class="line"> Git commit:        9013bf583a</span><br><span class="line"> Built:             Fri Oct 18 15:52:22 2019</span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Experimental:      false</span><br><span class="line"></span><br><span class="line">Server: Docker Engine - Community</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          19.03.4</span><br><span class="line">  API version:      1.40 (minimum version 1.12)</span><br><span class="line">  Go version:       go1.12.10</span><br><span class="line">  Git commit:       9013bf583a</span><br><span class="line">  Built:            Fri Oct 18 15:50:54 2019</span><br><span class="line">  OS/Arch:          linux/amd64</span><br><span class="line">  Experimental:     false</span><br><span class="line"> containerd:</span><br><span class="line">  Version:          1.2.10</span><br><span class="line">  GitCommit:        b34a5c8af56e510852c35414db4c1f4fa6172339</span><br><span class="line"> runc:</span><br><span class="line">  Version:          1.0.0-rc8+dev</span><br><span class="line">  GitCommit:        3e425f80a8c931f88e6d94a8c831b9d5aa481657</span><br><span class="line"> docker-init:</span><br><span class="line">  Version:          0.18.0</span><br><span class="line">  GitCommit:        fec3683</span><br></pre></td></tr></table></figure>

<h2 id="核查docker配置及启动情况"><a href="#核查docker配置及启动情况" class="headerlink" title="核查docker配置及启动情况"></a>核查docker配置及启动情况</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker info</span><br><span class="line">Client:</span><br><span class="line"> Debug Mode: false</span><br><span class="line"></span><br><span class="line">Server:</span><br><span class="line"> Containers: 0</span><br><span class="line">  Running: 0</span><br><span class="line">  Paused: 0</span><br><span class="line">  Stopped: 0</span><br><span class="line"> Images: 0</span><br><span class="line"> Server Version: 19.03.4</span><br><span class="line"> Storage Driver: overlay2</span><br><span class="line">  Backing Filesystem: xfs</span><br><span class="line">  Supports d_type: true</span><br><span class="line">  Native Overlay Diff: true</span><br><span class="line"> Logging Driver: json-file</span><br><span class="line"> Cgroup Driver: systemd</span><br><span class="line"> Plugins:</span><br><span class="line">  Volume: local</span><br><span class="line">  Network: bridge host ipvlan macvlan null overlay</span><br><span class="line">  Log: awslogs fluentd gcplogs gelf journald json-file local logentries splunk syslog</span><br><span class="line"> Swarm: inactive</span><br><span class="line"> Runtimes: runc</span><br><span class="line"> Default Runtime: runc</span><br><span class="line"> Init Binary: docker-init</span><br><span class="line"> containerd version: b34a5c8af56e510852c35414db4c1f4fa6172339</span><br><span class="line"> runc version: 3e425f80a8c931f88e6d94a8c831b9d5aa481657</span><br><span class="line"> init version: fec3683</span><br><span class="line"> Security Options:</span><br><span class="line">  seccomp</span><br><span class="line">   Profile: default</span><br><span class="line"> Kernel Version: 3.10.0-693.21.1.el7.x86_64</span><br><span class="line"> Operating System: CentOS Linux 7 (Core)</span><br><span class="line"> OSType: linux</span><br><span class="line"> Architecture: x86_64</span><br><span class="line"> CPUs: 4</span><br><span class="line"> Total Memory: 5.671GiB</span><br><span class="line"> Name: node4.98yz.cn</span><br><span class="line"> ID: BSY4:7UBM:AA4T:OYVU:CRVZ:H5V3:L5X2:KJD4:2PHI:H74W:33N4:23KB</span><br><span class="line"> Docker Root Dir: /data/docker</span><br><span class="line"> Debug Mode: false</span><br><span class="line"> Registry: https://index.docker.io/v1/</span><br><span class="line"> Labels:</span><br><span class="line"> Experimental: false</span><br><span class="line"> Insecure Registries:</span><br><span class="line">  quay.io</span><br><span class="line">  registry.access.redhat.com</span><br><span class="line">  127.0.0.0/8</span><br><span class="line"> Registry Mirrors:</span><br><span class="line">  https://q2gr04ke.mirror.aliyuncs.com/</span><br><span class="line"> Live Restore Enabled: true</span><br></pre></td></tr></table></figure>

<h2 id="启动第一个Docker容器"><a href="#启动第一个Docker容器" class="headerlink" title="启动第一个Docker容器"></a>启动第一个Docker容器</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker run hello-world</span><br><span class="line">Unable to find image 'hello-world:latest' locally</span><br><span class="line">latest: Pulling from library/hello-world</span><br><span class="line">1b930d010525: Pull complete </span><br><span class="line">Digest: sha256:c3b4ada4687bbaa170745b3e4dd8ac3f194ca95b2d0518b417fb47e5879d9b5f</span><br><span class="line">Status: Downloaded newer image for hello-world:latest</span><br><span class="line"></span><br><span class="line">Hello from Docker!</span><br><span class="line">This message shows that your installation appears to be working correctly.</span><br><span class="line"></span><br><span class="line">To generate this message, Docker took the following steps:</span><br><span class="line"> 1. The Docker client contacted the Docker daemon.</span><br><span class="line"> 2. The Docker daemon pulled the "hello-world" image from the Docker Hub.</span><br><span class="line">    (amd64)</span><br><span class="line"> 3. The Docker daemon created a new container from that image which runs the</span><br><span class="line">    executable that produces the output you are currently reading.</span><br><span class="line"> 4. The Docker daemon streamed that output to the Docker client, which sent it</span><br><span class="line">    to your terminal.</span><br><span class="line"></span><br><span class="line">To try something more ambitious, you can run an Ubuntu container with:</span><br><span class="line"><span class="meta"> $</span><span class="bash"> docker run -it ubuntu bash</span></span><br><span class="line"></span><br><span class="line">Share images, automate workflows, and more with a free Docker ID:</span><br><span class="line"> https://hub.docker.com/</span><br><span class="line"></span><br><span class="line">For more examples and ideas, visit:</span><br><span class="line"> https://docs.docker.com/get-started/</span><br></pre></td></tr></table></figure>

<h1 id="Docker的镜像管理"><a href="#Docker的镜像管理" class="headerlink" title="Docker的镜像管理"></a>Docker的镜像管理</h1><h2 id="hub-docker-com"><a href="#hub-docker-com" class="headerlink" title="hub.docker.com"></a>hub.docker.com</h2><img src = "/images/m_e35df76da442b5988c59e003b0f79ee3_r.png">

<h2 id="注册一个dockerhub账号"><a href="#注册一个dockerhub账号" class="headerlink" title="注册一个dockerhub账号"></a>注册一个dockerhub账号</h2><p>登录hub.docker.com</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker login docker.io</span><br><span class="line">Login with your Docker ID to push and pull images from Docker Hub. If you don't have a Docker ID, head over to https://hub.docker.com to create one.</span><br><span class="line">Username: sunrisenan</span><br><span class="line">Password: </span><br><span class="line">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br></pre></td></tr></table></figure>

<p>密码存在位置，用base64可以解码：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# cat /root/.docker/config.json </span><br><span class="line">&#123;</span><br><span class="line">    "auths": &#123;</span><br><span class="line">        "https://index.docker.io/v1/": &#123;</span><br><span class="line">            "auth": "c3VucmlzZW5hbjpseXo1MjAx="</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    "HttpHeaders": &#123;</span><br><span class="line">        "User-Agent": "Docker-Client/19.03.4 (linux)"</span><br><span class="line">    &#125;</span><br><span class="line">&#125;[root@node4 ~]# echo "c3VucmlzZW5hbjpseXo1MjAx="|base64 -d</span><br><span class="line">sunrisenan:123</span><br></pre></td></tr></table></figure>

<h2 id="搜索一个镜像"><a href="#搜索一个镜像" class="headerlink" title="搜索一个镜像"></a>搜索一个镜像</h2><ul>
<li>命令行搜索</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker search alpine</span><br><span class="line">NAME                                   DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED</span><br><span class="line">alpine                                 A minimal Docker image based on Alpine Linux…   5795                [OK]                </span><br><span class="line">mhart/alpine-node                      Minimal Node.js built on Alpine Linux           444                                     </span><br><span class="line">anapsix/alpine-java                    Oracle Java 8 (and 7) with GLIBC 2.28 over A…   428                                     [OK]</span><br><span class="line">frolvlad/alpine-glibc                  Alpine Docker image with glibc (~12MB)          218                                     [OK]</span><br><span class="line">gliderlabs/alpine                      Image based on Alpine Linux will help you wi…   180                                     </span><br><span class="line">mvertes/alpine-mongo                   light MongoDB container                         106                                     [OK]</span><br><span class="line">alpine/git                             A  simple git container running in alpine li…   100                                     [OK]</span><br><span class="line">yobasystems/alpine-mariadb             MariaDB running on Alpine Linux [docker] [am…   52                                      [OK]</span><br><span class="line">kiasaki/alpine-postgres                PostgreSQL docker image based on Alpine Linux   45                                      [OK]</span><br><span class="line">alpine/socat                           Run socat command in alpine container           39                                      [OK]</span><br><span class="line">davidcaste/alpine-tomcat               Apache Tomcat 7/8 using Oracle Java 7/8 with…   37                                      [OK]</span><br><span class="line">zzrot/alpine-caddy                     Caddy Server Docker Container running on Alp…   35                                      [OK]</span><br><span class="line">easypi/alpine-arm                      AlpineLinux for RaspberryPi                     32                                      </span><br><span class="line">jfloff/alpine-python                   A small, more complete, Python Docker image …   28                                      [OK]</span><br><span class="line">byrnedo/alpine-curl                    Alpine linux with curl installed and set as …   27                                      [OK]</span><br><span class="line">hermsi/alpine-sshd                     Dockerize your OpenSSH-server with rsync and…   26                                      [OK]</span><br><span class="line">etopian/alpine-php-wordpress           Alpine WordPress Nginx PHP-FPM WP-CLI           22                                      [OK]</span><br><span class="line">hermsi/alpine-fpm-php                  Dockerize your FPM PHP 7.4 upon a lightweigh…   21                                      [OK]</span><br><span class="line">bashell/alpine-bash                    Alpine Linux with /bin/bash as a default she…   14                                      [OK]</span><br><span class="line">zenika/alpine-chrome                   Chrome running in headless mode in a tiny Al…   14                                      [OK]</span><br><span class="line">davidcaste/alpine-java-unlimited-jce   Oracle Java 8 (and 7) with GLIBC 2.21 over A…   13                                      [OK]</span><br><span class="line">tenstartups/alpine                     Alpine linux base docker image with useful p…   9                                       [OK]</span><br><span class="line">spotify/alpine                         Alpine image with `bash` and `curl`.            9                                       [OK]</span><br><span class="line">roribio16/alpine-sqs                   Dockerized ElasticMQ server + web UI over Al…   7                                       [OK]</span><br><span class="line">rawmind/alpine-traefik                 This image is the traefik base. It comes fro…   5                                       [OK]</span><br></pre></td></tr></table></figure>

<ul>
<li>在网站上搜索</li>
</ul>
<img src = "/images/m_57e5346ff7517d24af888fdc6d1fabd6_r.png">

<h2 id="下载一个镜像"><a href="#下载一个镜像" class="headerlink" title="下载一个镜像"></a>下载一个镜像</h2><ul>
<li>直接下载</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker pull alpine</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/alpine</span><br><span class="line">89d9c30c1d48: Pull complete </span><br><span class="line">Digest: sha256:c19173c5ada610a5989151111163d28a67368362762534d8a8121ce95cf2bd5a</span><br><span class="line">Status: Downloaded newer image for alpine:latest</span><br><span class="line">docker.io/library/alpine:latest</span><br></pre></td></tr></table></figure>

<ul>
<li>下载指定tag</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker pull alpine:3.10.1</span><br><span class="line">3.10.1: Pulling from library/alpine</span><br><span class="line">050382585609: Pull complete </span><br><span class="line">Digest: sha256:6a92cd1fcdc8d8cdec60f33dda4db2cb1fcdcacf3410a8e05b3741f44a9b5998</span><br><span class="line">Status: Downloaded newer image for alpine:3.10.1</span><br><span class="line">docker.io/library/alpine:3.10.1</span><br></pre></td></tr></table></figure>

<blockquote>
<p>镜像的结构：registry_name/repository_name/image_name:tag_name<br>例如：docker.io/library/alpine:3.10.1</p>
</blockquote>
<h2 id="查看本地镜像"><a href="#查看本地镜像" class="headerlink" title="查看本地镜像"></a>查看本地镜像</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">alpine              latest              965ea09ff2eb        2 weeks ago         5.55MB</span><br><span class="line">alpine              3.10.1              b7b28af77ffe        3 months ago        5.58MB</span><br><span class="line">hello-world         latest              fce289e99eb9        10 months ago       1.84kB</span><br><span class="line"></span><br><span class="line">[root@node4 ~]# docker image ls</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">alpine              latest              965ea09ff2eb        2 weeks ago         5.55MB</span><br><span class="line">alpine              3.10.1              b7b28af77ffe        3 months ago        5.58MB</span><br><span class="line">hello-world         latest              fce289e99eb9        10 months ago       1.84kB</span><br></pre></td></tr></table></figure>

<h2 id="给镜像打标签"><a href="#给镜像打标签" class="headerlink" title="给镜像打标签"></a>给镜像打标签</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker tag b7b28af77ffe sunrisenan/alpine:3.10.1</span><br><span class="line">[root@node4 ~]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">alpine              latest              965ea09ff2eb        2 weeks ago         5.55MB</span><br><span class="line">alpine              3.10.1              b7b28af77ffe        3 months ago        5.58MB</span><br><span class="line">sunrisenan/alpine   3.10.1              b7b28af77ffe        3 months ago        5.58MB</span><br><span class="line">hello-world         latest              fce289e99eb9        10 months ago       1.84kB</span><br></pre></td></tr></table></figure>

<h2 id="推送镜像"><a href="#推送镜像" class="headerlink" title="推送镜像"></a>推送镜像</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker push sunrisenan/alpine:3.10.1</span><br><span class="line">The push refers to repository [docker.io/sunrisenan/alpine]</span><br><span class="line">1bfeebd65323: Mounted from library/alpine </span><br><span class="line">3.10.1: digest: sha256:57334c50959f26ce1ee025d08f136c2292c128f84e7b229d1b0da5dac89e9866 size: 528</span><br></pre></td></tr></table></figure>

<h2 id="给镜像再打一个标签"><a href="#给镜像再打一个标签" class="headerlink" title="给镜像再打一个标签"></a>给镜像再打一个标签</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker tag 965ea09ff2eb docker.io/sunrisenan/alpine:3.10.3</span><br><span class="line">[root@node4 ~]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">alpine              latest              965ea09ff2eb        2 weeks ago         5.55MB</span><br><span class="line">sunrisenan/alpine   3.10.3              965ea09ff2eb        2 weeks ago         5.55MB</span><br><span class="line">alpine              3.10.1              b7b28af77ffe        3 months ago        5.58MB</span><br><span class="line">sunrisenan/alpine   3.10.1              b7b28af77ffe        3 months ago        5.58MB</span><br><span class="line">hello-world         latest              fce289e99eb9        10 months ago       1.84kB</span><br></pre></td></tr></table></figure>

<h2 id="再次推送镜像"><a href="#再次推送镜像" class="headerlink" title="再次推送镜像"></a>再次推送镜像</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker push docker.io/sunrisenan/alpine:3.10.3</span><br><span class="line">The push refers to repository [docker.io/sunrisenan/alpine]</span><br><span class="line">77cae8ab23bf: Mounted from library/alpine </span><br><span class="line">3.10.3: digest: sha256:e4355b66995c96b4b468159fc5c7e3540fcef961189ca13fee877798649f531a size: 528</span><br></pre></td></tr></table></figure>

<h2 id="删除镜像"><a href="#删除镜像" class="headerlink" title="删除镜像"></a>删除镜像</h2><ul>
<li>删除镜像标签</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker rmi sunrisenan/alpine:3.10.1</span><br><span class="line">Untagged: sunrisenan/alpine:3.10.1</span><br><span class="line">Untagged: sunrisenan/alpine@sha256:57334c50959f26ce1ee025d08f136c2292c128f84e7b229d1b0da5dac89e9866</span><br><span class="line">[root@node4 ~]# docker images | grep alpine</span><br><span class="line">alpine              latest              965ea09ff2eb        2 weeks ago         5.55MB</span><br><span class="line">sunrisenan/alpine   3.10.3              965ea09ff2eb        2 weeks ago         5.55MB</span><br><span class="line">alpine              3.10.1              b7b28af77ffe        3 months ago        5.58MB</span><br></pre></td></tr></table></figure>

<ul>
<li>删除镜像</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker rmi b7b28af77ffe</span><br><span class="line">Untagged: alpine:3.10.1</span><br><span class="line">Untagged: alpine@sha256:6a92cd1fcdc8d8cdec60f33dda4db2cb1fcdcacf3410a8e05b3741f44a9b5998</span><br><span class="line">Deleted: sha256:b7b28af77ffec6054d13378df4fdf02725830086c7444d9c278af25312aa39b9</span><br><span class="line">Deleted: sha256:1bfeebd65323b8ddf5bd6a51cc7097b72788bc982e9ab3280d53d3c613adffa7</span><br></pre></td></tr></table></figure>

<ul>
<li>删除镜像标签及镜像</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker images | grep alpine</span><br><span class="line">alpine              latest              965ea09ff2eb        2 weeks ago         5.55MB</span><br><span class="line">sunrisenan/alpine   3.10.3              965ea09ff2eb        2 weeks ago         5.55MB</span><br><span class="line">[root@node4 ~]# docker rmi -f 965ea09ff2eb   # -f 强制删除（包括标签及镜像）</span><br><span class="line">Untagged: alpine:latest</span><br><span class="line">Untagged: alpine@sha256:c19173c5ada610a5989151111163d28a67368362762534d8a8121ce95cf2bd5a</span><br><span class="line">Untagged: sunrisenan/alpine:3.10.3</span><br><span class="line">Untagged: sunrisenan/alpine@sha256:e4355b66995c96b4b468159fc5c7e3540fcef961189ca13fee877798649f531a</span><br><span class="line">Deleted: sha256:965ea09ff2ebd2b9eeec88cd822ce156f6674c7e99be082c7efac3c62f3ff652</span><br><span class="line">Deleted: sha256:77cae8ab23bf486355d1b3191259705374f4a11d483b24964d2f729dd8c076a0</span><br><span class="line">[root@node4 ~]# docker images | grep alpine</span><br><span class="line">[root@node4 ~]#</span><br></pre></td></tr></table></figure>

<h2 id="Docker-镜像新特性"><a href="#Docker-镜像新特性" class="headerlink" title="Docker 镜像新特性"></a>Docker 镜像新特性</h2><img src = "/images/m_2bb8359fdcc9e0812b295d36a3150bb9_r.png">

<img src = "/images/m_f24dd512522de9ee061bd32e34070db2_r.png">

<h1 id="Docker的基本操作"><a href="#Docker的基本操作" class="headerlink" title="Docker的基本操作"></a>Docker的基本操作</h1><p>##查看本地的容器进程</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                   PORTS               NAMES</span><br><span class="line">e63ab3e10bd6        hello-world         "/hello"            2 hours ago         Exited (0) 2 hours ago                       epic_bohr</span><br></pre></td></tr></table></figure>

<h2 id="启动容器（运行镜像）"><a href="#启动容器（运行镜像）" class="headerlink" title="启动容器（运行镜像）"></a>启动容器（运行镜像）</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker run是日常用的最频繁的命令之一，同样也是较为复杂的命令之一</span><br><span class="line">命令格式：docker run [OPTIONS] IMAGE [COMMAND] [ARG..]</span><br><span class="line">OPTIONS:选项</span><br><span class="line">    -i：表示启动一个可交互的容器，并持续打开标准输入</span><br><span class="line">    -t:表示使用终端关联到容器的标准输入输出上</span><br><span class="line">    -d：表示将容器放置后台运行</span><br><span class="line">    --rm：退出后即删除容器</span><br><span class="line">    --name：表示定义容器的唯一名称</span><br><span class="line">    IMAGE：表示要运行的镜像</span><br><span class="line">    COMMAND：表示启动容器时要运行的命令</span><br></pre></td></tr></table></figure>

<p><strong>交互式启动一个容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker run -ti sunrisenan/alpine:3.10.3 /bin/sh</span><br><span class="line">Unable to find image 'sunrisenan/alpine:3.10.3' locally</span><br><span class="line">3.10.3: Pulling from sunrisenan/alpine</span><br><span class="line">89d9c30c1d48: Pull complete </span><br><span class="line">Digest: sha256:e4355b66995c96b4b468159fc5c7e3540fcef961189ca13fee877798649f531a</span><br><span class="line">Status: Downloaded newer image for sunrisenan/alpine:3.10.3</span><br><span class="line">/ # cat /etc/issue </span><br><span class="line">Welcome to Alpine Linux 3.10</span><br><span class="line">Kernel \r on an \m (\l)</span><br></pre></td></tr></table></figure>

<p><strong>非交互式启动一个容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker run --rm sunrisenan/alpine:3.10.3 /bin/echo hello</span><br><span class="line">hello</span><br></pre></td></tr></table></figure>

<p><strong>非交互式启动一个后台容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker run -d --name myalpine sunrisenan/alpine:3.10.3 /bin/sleep 300</span><br><span class="line">3d015bfe776af7c14d8acbfecb6a09d2573a8e332d73a67030e4d3f651c03d2a</span><br></pre></td></tr></table></figure>

<p>##查看容器</p>
<p><strong>查看运行中的容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE                      COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">3d015bfe776a        sunrisenan/alpine:3.10.3   "/bin/sleep 300"    4 minutes ago       Up 4 minutes                            myalpine</span><br></pre></td></tr></table></figure>

<p><strong>查看所有容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE                      COMMAND             CREATED              STATUS                     PORTS               NAMES</span><br><span class="line">7ecf398c77e4        hello-world                "/hello"            6 seconds ago        Exited (0) 5 seconds ago                       funny_wright</span><br><span class="line">c44608564744        sunrisenan/alpine:3.10.3   "/bin/sleep 300"    About a minute ago   Up About a minute                              myalpine</span><br></pre></td></tr></table></figure>

<p><strong>查看宿主机进程</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# ps -aux|grep sleep|grep -v grep</span><br><span class="line">root      6226  0.0  0.0   1540   248 ?        Ss   16:39   0:00 /bin/sleep 300</span><br></pre></td></tr></table></figure>

<h2 id="进入容器"><a href="#进入容器" class="headerlink" title="进入容器"></a>进入容器</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker exec -it myalpine /bin/sh</span><br><span class="line">/ # ps aux</span><br><span class="line">PID   USER     TIME  COMMAND</span><br><span class="line">    1 root      0:00 /bin/sleep 300</span><br><span class="line">    7 root      0:00 /bin/sh</span><br><span class="line">   12 root      0:00 ps aux</span><br><span class="line"></span><br><span class="line">/ # exit   # 退出容器</span><br></pre></td></tr></table></figure>

<blockquote>
<p>docker attach 不推荐使用</p>
</blockquote>
<h2 id="停止-启动-重启容器"><a href="#停止-启动-重启容器" class="headerlink" title="停止/启动/重启容器"></a>停止/启动/重启容器</h2><p><strong>停止容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE                      COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">2d60b6eac204        sunrisenan/alpine:3.10.3   "/bin/sleep 300"    3 minutes ago       Up 3 minutes    </span><br><span class="line">myalpine</span><br><span class="line">[root@node4 ~]# docker stop myalpine</span><br><span class="line">myalpine</span><br><span class="line"></span><br><span class="line">[root@node4 ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE                      COMMAND             CREATED             STATUS                        PORTS               NAMES</span><br><span class="line">2d60b6eac204        sunrisenan/alpine:3.10.3   "/bin/sleep 300"    4 minutes ago       Exited (137) 11 seconds ago                       myalpine</span><br></pre></td></tr></table></figure>

<p><strong>启动容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker start myalpine</span><br><span class="line">myalpine</span><br><span class="line">[root@node4 ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE                      COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">2d60b6eac204        sunrisenan/alpine:3.10.3   "/bin/sleep 300"    7 minutes ago       Up 8 seconds                            myalpine</span><br></pre></td></tr></table></figure>

<p><strong>重启容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker restart myalpine</span><br><span class="line">myalpine</span><br><span class="line">[root@node4 ~]# docker ps -a|grep myalpine</span><br><span class="line">2d60b6eac204        sunrisenan/alpine:3.10.3   "/bin/sleep 300"    9 minutes ago       Up 28 seconds                           myalpine</span><br></pre></td></tr></table></figure>

<h2 id="删除容器"><a href="#删除容器" class="headerlink" title="删除容器"></a>删除容器</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker rm myalpine</span><br><span class="line">Error response from daemon: You cannot remove a running container db3335af09774651f55715b1da66ba930060b488ebdc7c4dc4ce67ce933dfc8e. Stop the container before attempting removal or force remove</span><br><span class="line">[root@node4 ~]# docker rm -f myalpine</span><br><span class="line">myalpine</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果容器还未终止，需要用docker rm -f 进行强制删除</p>
</blockquote>
<p><strong>删除已停止的容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# for i in `docker ps -a|grep -i exit|awk '&#123;print $1&#125;'`;do docker rm -f $i;done</span><br></pre></td></tr></table></figure>

<p><strong>删除所有的容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# for i in `docker ps -qa`;do docker rm -f $i;done</span><br></pre></td></tr></table></figure>

<h2 id="修改-提交容器"><a href="#修改-提交容器" class="headerlink" title="修改/提交容器"></a>修改/提交容器</h2><p><strong>修改容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker run -d --name myalpine sunrisenan/alpine:3.10.3 /bin/sleep 300</span><br><span class="line">279bf6153576afcc8ca902d8c93282ec138b08704beb1f11f81fa106e0e2ad68</span><br><span class="line"></span><br><span class="line">[root@node4 ~]# docker ps </span><br><span class="line">CONTAINER ID        IMAGE                      COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">279bf6153576        sunrisenan/alpine:3.10.3   "/bin/sleep 300"    13 seconds ago      Up 11 seconds                           myalpine</span><br><span class="line"></span><br><span class="line">[root@node4 ~]# docker exec -it 279bf6153576 /bin/sh</span><br><span class="line">/ # pwd</span><br><span class="line">/</span><br><span class="line">/ # echo Hello &gt; 1.txt</span><br><span class="line">/ # ls</span><br><span class="line">1.txt  bin    dev    etc    home   lib    media  mnt    opt    proc   root   run    sbin   srv    sys    tmp    usr    var</span><br><span class="line">/ # exit</span><br></pre></td></tr></table></figure>

<p><strong>提交容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker commit -p 279bf6153576 sunrisenan/alpine:3.10.3_with_1.txt</span><br><span class="line">sha256:5a766219fd567129bbc12f3e1293b782c35d7213ed5b54d8522e69a9f11c28b9</span><br></pre></td></tr></table></figure>

<blockquote>
<p>-p 不让其他的内容再写进来了</p>
</blockquote>
<p><strong>检验</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker run --rm sunrisenan/alpine:3.10.3_with_1.txt /bin/cat /1.txt</span><br><span class="line">Hello</span><br></pre></td></tr></table></figure>

<blockquote>
<p>也可以使用docker export 279bf6153576 &gt;myalpine_with_1.txt.tar</p>
</blockquote>
<h2 id="导出-导入容器"><a href="#导出-导入容器" class="headerlink" title="导出/导入容器"></a>导出/导入容器</h2><p><strong>导出镜像</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">sunrisenan/alpine   3.10.3_with_1.txt   5a766219fd56        7 minutes ago       5.55MB</span><br><span class="line">sunrisenan/alpine   3.10.3              965ea09ff2eb        2 weeks ago         5.55MB</span><br><span class="line">sunrisenan/alpine   3.10.1              b7b28af77ffe        3 months ago        5.58MB</span><br><span class="line">hello-world         latest              fce289e99eb9        10 months ago       1.84kB</span><br><span class="line">[root@node4 ~]# docker save 5a766219fd56 &gt; alpine_with_1.txt.tar</span><br><span class="line">[root@node4 ~]# ls</span><br><span class="line">alpine_with_1.txt.tar  anaconda-ks.cfg</span><br></pre></td></tr></table></figure>

<blockquote>
<p>导出的时候尽量加上版本号</p>
</blockquote>
<p><strong>导入镜像</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker rmi -f 5a766219fd56</span><br><span class="line">Untagged: sunrisenan/alpine:3.10.3_with_1.txt</span><br><span class="line">Deleted: sha256:5a766219fd567129bbc12f3e1293b782c35d7213ed5b54d8522e69a9f11c28b9</span><br><span class="line">Deleted: sha256:34e6c5bebdd97e107ec3de8fb873b6f8bdd68fd593b511a737d41e62f80f58a8</span><br><span class="line"></span><br><span class="line">[root@node4 ~]# docker load &lt; ./alpine_with_1.txt.tar </span><br><span class="line">a87bd13a8b89: Loading layer [==================================================&gt;]  3.584kB/3.584kB</span><br><span class="line">Loaded image ID: sha256:5a766219fd567129bbc12f3e1293b782c35d7213ed5b54d8522e69a9f11c28b9</span><br><span class="line">[root@node4 ~]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">&lt;none&gt;              &lt;none&gt;              5a766219fd56        10 minutes ago      5.55MB</span><br><span class="line">sunrisenan/alpine   3.10.3              965ea09ff2eb        2 weeks ago         5.55MB</span><br><span class="line">sunrisenan/alpine   3.10.1              b7b28af77ffe        3 months ago        5.58MB</span><br><span class="line">hello-world         latest              fce289e99eb9        10 months ago       1.84kB</span><br><span class="line"></span><br><span class="line">[root@node4 ~]# docker tag 5a766219fd56 sunrisenan/alpine:v3.10.3_with_1.txt</span><br><span class="line">[root@node4 ~]# docker images</span><br><span class="line">REPOSITORY          TAG                  IMAGE ID            CREATED             SIZE</span><br><span class="line">sunrisenan/alpine   v3.10.3_with_1.txt   5a766219fd56        12 minutes ago      5.55MB</span><br><span class="line">sunrisenan/alpine   3.10.3               965ea09ff2eb        2 weeks ago         5.55MB</span><br><span class="line">sunrisenan/alpine   3.10.1               b7b28af77ffe        3 months ago        5.58MB</span><br><span class="line">hello-world         latest               fce289e99eb9        10 months ago       1.84kB</span><br></pre></td></tr></table></figure>

<p><strong>检验镜像</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker run --rm -it --name myalpine_with_1.txt sunrisenan/alpine:v3.10.3_with_1.txt /bin/cat /1.txt</span><br><span class="line">Hello</span><br></pre></td></tr></table></figure>

<h2 id="查看容器日志"><a href="#查看容器日志" class="headerlink" title="查看容器日志"></a>查看容器日志</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker run hello-world 2&gt;&amp;1 &gt;&gt;/dev/null </span><br><span class="line">[root@node4 ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                      PORTS               NAMES</span><br><span class="line">2c71417a3b27        hello-world         "/hello"            16 seconds ago      Exited (0) 15 seconds ago                       goofy_goldstine</span><br><span class="line"></span><br><span class="line">[root@node4 ~]# docker logs 2c71417a3b27</span><br><span class="line"></span><br><span class="line">Hello from Docker!</span><br><span class="line">This message shows that your installation appears to be working correctly.</span><br><span class="line"></span><br><span class="line">To generate this message, Docker took the following steps:</span><br><span class="line"> 1. The Docker client contacted the Docker daemon.</span><br><span class="line"> 2. The Docker daemon pulled the "hello-world" image from the Docker Hub.</span><br><span class="line">    (amd64)</span><br><span class="line"> 3. The Docker daemon created a new container from that image which runs the</span><br><span class="line">    executable that produces the output you are currently reading.</span><br><span class="line"> 4. The Docker daemon streamed that output to the Docker client, which sent it</span><br><span class="line">    to your terminal.</span><br><span class="line"></span><br><span class="line">To try something more ambitious, you can run an Ubuntu container with:</span><br><span class="line"><span class="meta"> $</span><span class="bash"> docker run -it ubuntu bash</span></span><br><span class="line"></span><br><span class="line">Share images, automate workflows, and more with a free Docker ID:</span><br><span class="line"> https://hub.docker.com/</span><br><span class="line"></span><br><span class="line">For more examples and ideas, visit:</span><br><span class="line"> https://docs.docker.com/get-started/</span><br></pre></td></tr></table></figure>

<blockquote>
<p>docker logs -f 2c71417a3b27 (-f 可以看实时日志)</p>
</blockquote>
<h1 id="Docker的高级操作"><a href="#Docker的高级操作" class="headerlink" title="Docker的高级操作"></a>Docker的高级操作</h1><h2 id="下载nginx镜像"><a href="#下载nginx镜像" class="headerlink" title="下载nginx镜像"></a>下载nginx镜像</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker pull nginx:1.12.2</span><br><span class="line">1.12.2: Pulling from library/nginx</span><br><span class="line">f2aa67a397c4: Pull complete </span><br><span class="line">e3eaf3d87fe0: Pull complete </span><br><span class="line">38cb13c1e4c9: Pull complete </span><br><span class="line">Digest: sha256:72daaf46f11cc753c4eab981cbf869919bd1fee3d2170a2adeac12400f494728</span><br><span class="line">Status: Downloaded newer image for nginx:1.12.2</span><br><span class="line">docker.io/library/nginx:1.12.2</span><br><span class="line">[root@node4 ~]# docker images | grep nginx</span><br><span class="line">nginx               1.12.2               4037a5562b03        18 months ago       108MB</span><br><span class="line">[root@node4 ~]# docker tag 4037a5562b03 sunrisenan/nginx:v1.12.2</span><br><span class="line">[root@node4 ~]# docker images | grep nginx</span><br><span class="line">nginx               1.12.2               4037a5562b03        18 months ago       108MB</span><br><span class="line">sunrisenan/nginx    v1.12.2              4037a5562b03        18 months ago       108MB</span><br></pre></td></tr></table></figure>

<h2 id="映射端口"><a href="#映射端口" class="headerlink" title="映射端口"></a>映射端口</h2><ul>
<li>docker run -p 容器外的端口：容器内的端口</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker run -d -p81:80 sunrisenan/nginx:v1.12.2</span><br><span class="line">19a8f420ac6fdc8c1a8d6a293dc49313134efaa63592a5d5d2b6272caf5ce1e8</span><br><span class="line">[root@node4 ~]# netstat -lntup|grep 81</span><br><span class="line">tcp6       0      0 :::81                   :::*                    LISTEN      9313/docker-proxy</span><br><span class="line"></span><br><span class="line">[root@node4 ~]# curl 127.0.0.1:81</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    body &#123;</span><br><span class="line">        width: 35em;</span><br><span class="line">        margin: 0 auto;</span><br><span class="line">        font-family: Tahoma, Verdana, Arial, sans-serif;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;For online documentation and support please refer to</span><br><span class="line">&lt;a href="http://nginx.org/"&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;</span><br><span class="line">Commercial support is available at</span><br><span class="line">&lt;a href="http://nginx.com/"&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="挂载数据卷"><a href="#挂载数据卷" class="headerlink" title="挂载数据卷"></a>挂载数据卷</h2><ul>
<li>docker run -v 容器外的目录：容器内的目录</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# mkdir html</span><br><span class="line">[root@node4 ~]# cd html/</span><br><span class="line">[root@node4 html]# wget www.baidu.com -O index.html</span><br><span class="line">--2019-11-06 18:12:06--  http://www.baidu.com/</span><br><span class="line">Resolving www.baidu.com (www.baidu.com)... 180.101.49.12, 180.101.49.11</span><br><span class="line">Connecting to www.baidu.com (www.baidu.com)|180.101.49.12|:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 2381 (2.3K) [text/html]</span><br><span class="line">Saving to: ‘index.html’</span><br><span class="line"></span><br><span class="line"><span class="meta">100%</span><span class="bash">[===========================================================================================&gt;] 2,381       --.-K/s   <span class="keyword">in</span> 0s      </span></span><br><span class="line"></span><br><span class="line">2019-11-06 18:12:11 (186 MB/s) - ‘index.html’ saved [2381/2381]</span><br><span class="line"></span><br><span class="line">[root@node4 html]# docker run -d -p82:80 -v /root/html:/usr/share/nginx/html sunrisenan/nginx:v1.12.2</span><br><span class="line">d44ce0d1bb4e42773dda95825cbc1a1989a38b704d0a133487f0adc054fbc88f</span><br><span class="line">[root@node4 html]# docker ps -a | grep nginx</span><br><span class="line">d44ce0d1bb4e        sunrisenan/nginx:v1.12.2   "nginx -g 'daemon of…"   24 seconds ago      Up 23 seconds       0.0.0.0:82-&gt;80/tcp   elated_williams</span><br><span class="line">a5393a15159b        sunrisenan/nginx:v1.12.2   "nginx -g 'daemon of…"   4 minutes ago       Up 4 minutes        0.0.0.0:81-&gt;80/tcp   optimistic_rubin</span><br></pre></td></tr></table></figure>

<p>浏览器打开<a href="http://192.168.6.244:82/" target="_blank" rel="noopener">http://192.168.6.244:82</a></p>
<img src = "/images/m_0242e19875fcab5b236bd7b25875c43a_r.png">

<p><strong>查看挂载：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker inspect d44ce0d1bb4e</span><br><span class="line">...</span><br><span class="line">        "Mounts": [</span><br><span class="line">            &#123;</span><br><span class="line">                "Type": "bind",</span><br><span class="line">                "Source": "/root/html",</span><br><span class="line">                "Destination": "/usr/share/nginx/html",</span><br><span class="line">                "Mode": "",</span><br><span class="line">                "RW": true,</span><br><span class="line">                "Propagation": "rprivate"</span><br><span class="line">            &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="传递环境变量"><a href="#传递环境变量" class="headerlink" title="传递环境变量"></a>传递环境变量</h2><ul>
<li>docker run -e 环境变量key：环境变量value</li>
</ul>
<p><strong>传递一个环境变量</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker run --rm -e E_OPTS=abcdefg sunrisenan/nginx:v1.12.2 printenv</span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">HOSTNAME=3011a2978c7c</span><br><span class="line">E_OPTS=abcdefg</span><br><span class="line">NGINX_VERSION=1.12.2-1~stretch</span><br><span class="line">NJS_VERSION=1.12.2.0.1.14-1~stretch</span><br><span class="line">HOME=/root</span><br></pre></td></tr></table></figure>

<p><strong>传递两个环境变量</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker run --rm -e E_OPTS=abcdefg -e G_OPES=123@PASS  sunrisenan/nginx:v1.12.2 printenv</span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">HOSTNAME=1bbb50ae0017</span><br><span class="line">G_OPES=123@PASS</span><br><span class="line">E_OPTS=abcdefg</span><br><span class="line">NGINX_VERSION=1.12.2-1~stretch</span><br><span class="line">NJS_VERSION=1.12.2.0.1.14-1~stretch</span><br><span class="line">HOME=/root</span><br></pre></td></tr></table></figure>

<h2 id="容器内安装软件（工具）"><a href="#容器内安装软件（工具）" class="headerlink" title="容器内安装软件（工具）"></a>容器内安装软件（工具）</h2><ul>
<li>yum/apt-get/apt等</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker run --rm -it  sunrisenan/nginx:v1.12.2 bash</span><br><span class="line">root@626e6ba6a358:/# curl</span><br><span class="line">bash: curl: command not found</span><br><span class="line">root@626e6ba6a358:/# tee /etc/apt/sources.list &lt;&lt; EOF</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> deb http://mirrors.163.com/debian/ jessie main non-free contrib</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> deb http://mirrors.163.com/debian/ jessie-updates main non-free contrib</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> EOF</span></span><br><span class="line">deb http://mirrors.163.com/debian/ jessie main non-free contrib</span><br><span class="line">deb http://mirrors.163.com/debian/ jessie-updates main non-free contrib</span><br><span class="line"></span><br><span class="line">root@626e6ba6a358:/# apt-get update &amp;&amp; apt-get install curl -y</span><br></pre></td></tr></table></figure>

<blockquote>
<p>提交容器并推送至dockerhub，这个景象还有用！</p>
</blockquote>
<p><strong>镜像固化并推送到镜像仓库</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker commit -p 626e6ba6a358 sunrisenan/nginx:curl</span><br><span class="line">sha256:6ea518f9d8f6da45c14b9aa83043a62b7d0f639ceb821d718db545eea30f8693</span><br><span class="line"></span><br><span class="line">[root@node4 ~]# docker images | grep curl</span><br><span class="line">sunrisenan/nginx    curl                 6ea518f9d8f6        About a minute ago   136MB</span><br><span class="line"></span><br><span class="line">[root@node4 ~]# docker push sunrisenan/nginx:curl</span><br><span class="line">The push refers to repository [docker.io/sunrisenan/nginx]</span><br><span class="line">b7f991e1e7fd: Pushed </span><br><span class="line">4258832b2570: Mounted from library/nginx </span><br><span class="line">683a28d1d7fd: Mounted from library/nginx </span><br><span class="line">d626a8ad97a1: Mounted from library/nginx </span><br><span class="line">curl: digest: sha256:03d6586ea5dcb82233f028340d85b96e7534aa3878180847729f1bd44c8384e6 size: 1160</span><br></pre></td></tr></table></figure>

<h2 id="容器的生命周期"><a href="#容器的生命周期" class="headerlink" title="容器的生命周期"></a>容器的生命周期</h2><ul>
<li>检查本地是否存在镜像，如果不存在即从远端仓库检索</li>
<li>利用镜像启动容器</li>
<li>分配一个文件系统，并在只读的镜像层外挂载一层可读写层</li>
<li>从宿主机配置的网桥接口中桥接一个虚拟接口到容器</li>
<li>从地址池配置一个ip地址给容器</li>
<li>执行用户指定的指令</li>
<li>执行完毕后容器终止</li>
</ul>
<img src = "/images/m_81a9f584cb7dd9a685d3524018654531_r.png">

<h1 id="Docker-file详解"><a href="#Docker-file详解" class="headerlink" title="Docker file详解"></a>Docker file详解</h1><h2 id="Docker-file介绍"><a href="#Docker-file介绍" class="headerlink" title="Docker file介绍"></a>Docker file介绍</h2><p>构建镜像的两种方式：</p>
<img src = "/images/m_d97f57d111f60cca54b2337d4c9c5e75_r.png">

<img src = "/images/m_ff6fef7a652299892c47896bfa844f4e_r.png">

<img src = "/images/m_a17fd06bc4d871030347291db2d72174_r.png">

<ul>
<li><strong>Dockerfile</strong><ul>
<li>Dockerfile是一个文本文件，文件名：Dockerfile</li>
<li>所有Dockerfile都是由FROM指令开始的</li>
<li>构建命令：docker build . -t [registry]/[repositort]:[tag]</li>
</ul>
</li>
</ul>
<h2 id="USER-WORKDIR指令"><a href="#USER-WORKDIR指令" class="headerlink" title="USER/WORKDIR指令"></a>USER/WORKDIR指令</h2><ul>
<li>Dockerfile</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi /data/dockerfile/Dockerfile</span><br><span class="line"></span><br><span class="line">FROM sunrisenan/nginx:v1.12.2</span><br><span class="line">USER nginx</span><br><span class="line">WORKDIR /usr/share/nginx/html</span><br></pre></td></tr></table></figure>

<ul>
<li>构建镜像</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 dockerfile]# docker build . -t sunrisenan/nginx:v1.12.2_with_user_workdir</span><br><span class="line">Sending build context to Docker daemon  2.048kB</span><br><span class="line">Step 1/3 : FROM sunrisenan/nginx:v1.12.2</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 4037a5562b03</span></span><br><span class="line">Step 2/3 : USER nginx</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> ed1dad767416</span></span><br><span class="line">Removing intermediate container ed1dad767416</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 2e96a40b4b85</span></span><br><span class="line">Step 3/3 : WORKDIR /usr/share/nginx/html</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 35613b2afbe0</span></span><br><span class="line">Removing intermediate container 35613b2afbe0</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 20a3068e906c</span></span><br><span class="line">Successfully built 20a3068e906c</span><br><span class="line">Successfully tagged sunrisenan/nginx:v1.12.2_with_user_workdir</span><br></pre></td></tr></table></figure>

<ul>
<li>验证</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 dockerfile]# docker run --rm  -it --name nginx123  20a3068e906c /bin/bash</span><br><span class="line">nginx@114eb12feb40:/usr/share/nginx/html$ whoami</span><br><span class="line">nginx</span><br><span class="line">nginx@114eb12feb40:/usr/share/nginx/html$ pwd</span><br><span class="line">/usr/share/nginx/html</span><br></pre></td></tr></table></figure>

<h2 id="ADD-EXPOSE指令"><a href="#ADD-EXPOSE指令" class="headerlink" title="ADD/EXPOSE指令"></a>ADD/EXPOSE指令</h2><ul>
<li>Dockerfile</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget -O /data/dockerfile/index.html www.baidu.com</span><br><span class="line">vi /data/dockerfile/Dockerfile</span><br><span class="line"></span><br><span class="line">FROM sunrisenan/nginx:v1.12.2</span><br><span class="line">ADD index.html /usr/share/nginx/html/index.html</span><br><span class="line">EXPOSE 80</span><br></pre></td></tr></table></figure>

<ul>
<li>构建镜像</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 dockerfile]# docker build . -t sunrisenan/nginx:v1.12.2_with_index_expose</span><br><span class="line">Sending build context to Docker daemon   5.12kB</span><br><span class="line">Step 1/3 : FROM sunrisenan/nginx:v1.12.2</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 4037a5562b03</span></span><br><span class="line">Step 2/3 : ADD index.html /usr/share/nginx/html/index.html</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 6e35f2fd8a8c</span></span><br><span class="line">Step 3/3 : EXPOSE 80</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> d5f714442b32</span></span><br><span class="line">Removing intermediate container d5f714442b32</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 643ede2cc9e0</span></span><br><span class="line">Successfully built 643ede2cc9e0</span><br><span class="line">Successfully tagged sunrisenan/nginx:v1.12.2_with_index_expose</span><br></pre></td></tr></table></figure>

<ul>
<li>验证1</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 dockerfile]# docker run -P  --rm  -it --name nginx123  sunrisenan/nginx:v1.12.2_with_index_expose /bin/bash</span><br><span class="line">root@f5b5689c3442:/# nginx -g "daemon off;"</span><br><span class="line"></span><br><span class="line">[root@node4 dockerfile]# netstat -lntup|grep docker-proxy</span><br><span class="line">tcp6       0      0 :::81                   :::*                    LISTEN      10609/docker-proxy  </span><br><span class="line">tcp6       0      0 :::82                   :::*                    LISTEN      10806/docker-proxy  </span><br><span class="line">tcp6       0      0 :::4000                 :::*                    LISTEN      22183/docker-proxy</span><br></pre></td></tr></table></figure>

<blockquote>
<p>-P随机暴露一个端口</p>
</blockquote>
<ul>
<li>验证2</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 dockerfile]# docker run -P -d --rm --name nginx123  sunrisenan/nginx:v1.12.2_with_index_expose</span><br><span class="line">54007722a39f28c7c7ede6125fbb3f51c76bcdb7004d7635d1f37385573cb70a</span><br><span class="line"></span><br><span class="line">[root@node4 dockerfile]# netstat -lntup|grep docker</span><br><span class="line">tcp6       0      0 :::81                   :::*                    LISTEN      10609/docker-proxy  </span><br><span class="line">tcp6       0      0 :::82                   :::*                    LISTEN      10806/docker-proxy  </span><br><span class="line">tcp6       0      0 :::4001                 :::*                    LISTEN      22324/docker-proxy</span><br></pre></td></tr></table></figure>

<blockquote>
<p>EXPOSE 80 写不写都行,都能用-p 都能映射出来</p>
</blockquote>
<h2 id="RUN-ENV指令"><a href="#RUN-ENV指令" class="headerlink" title="RUN/ENV指令"></a>RUN/ENV指令</h2><ul>
<li>Dockerfile</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi /data/dockerfile/Dockerfile</span><br><span class="line"></span><br><span class="line">FROM centos:7</span><br><span class="line">ENV VER 9.11.4</span><br><span class="line">RUN yum install bind-$VER -y</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ENV VER 空格 什么，或VER= 什么,ENV可以在构建镜像里面用，同时也可以在系统里面用<br>RUN 在构建镜像的时候执行一些可执行命令</p>
</blockquote>
<ul>
<li>构建镜像</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 dockerfile]# docker build . -t sunrisenan/bind:v9.11.4_with_env_run</span><br><span class="line">Sending build context to Docker daemon   5.12kB</span><br><span class="line">Step 1/3 : FROM centos:7</span><br><span class="line">7: Pulling from library/centos</span><br><span class="line">d8d02d457314: Already exists </span><br><span class="line">Digest: sha256:307835c385f656ec2e2fec602cf093224173c51119bbebd602c53c3653a3d6eb</span><br><span class="line">Status: Downloaded newer image for centos:7</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 67fa590cfc1c</span></span><br><span class="line">Step 2/3 : ENV VER 9.11.4</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 5a554643a9d0</span></span><br><span class="line">Removing intermediate container 5a554643a9d0</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 41bb82f39287</span></span><br><span class="line">Step 3/3 : RUN yum install bind-$VER -y</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> c80fa75b61af</span></span><br><span class="line">Loaded plugins: fastestmirror, ovl</span><br><span class="line">Determining fastest mirrors</span><br><span class="line"> * base: ftp.sjtu.edu.cn</span><br><span class="line"> * extras: mirrors.aliyun.com</span><br><span class="line"> * updates: mirrors.aliyun.com</span><br><span class="line">Resolving Dependencies</span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package bind.x86_64 32:9.11.4-9.P2.el7 will be installed</span></span><br><span class="line">.....</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> c6f46e66d43d</span></span><br><span class="line">Successfully built c6f46e66d43d</span><br><span class="line">Successfully tagged sunrisenan/bind:v9.11.4_with_env_run</span><br></pre></td></tr></table></figure>

<ul>
<li>运行容器</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 dockerfile]# docker run --rm sunrisenan/bind:v9.11.4_with_env_run rpm -qa bind</span><br><span class="line">bind-9.11.4-9.P2.el7.x86_64</span><br><span class="line"></span><br><span class="line">[root@node4 dockerfile]# docker run --rm sunrisenan/bind:v9.11.4_with_env_run printenv</span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">HOSTNAME=d71390b7a05c</span><br><span class="line">VER=9.11.4</span><br><span class="line">HOME=/root</span><br></pre></td></tr></table></figure>

<h2 id="CMD-ENTRYPOINT指令"><a href="#CMD-ENTRYPOINT指令" class="headerlink" title="CMD/ENTRYPOINT指令"></a>CMD/ENTRYPOINT指令</h2><blockquote>
<p>CMD指令和ENTRYPOINT指令作用相同，使用方法略有不同</p>
</blockquote>
<h3 id="CMD指令"><a href="#CMD指令" class="headerlink" title="CMD指令"></a>CMD指令</h3><ul>
<li>Dockerfile</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi /data/dockerfile/Dockerfile</span><br><span class="line"></span><br><span class="line">FROM centos:7</span><br><span class="line">RUN yum install httpd -y</span><br><span class="line">CMD ["httpd","-D","FOREGROUND"]    # 让其前台运行</span><br></pre></td></tr></table></figure>

<ul>
<li>构建镜像</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 dockerfile]# docker build . -t sunrisenan/httpd:test</span><br></pre></td></tr></table></figure>

<ul>
<li>运行容器</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 dockerfile]# docker run -d --rm  --name myhttpd -p83:80 sunrisenan/httpd:test</span><br><span class="line">9d8153320901e7ebf609eecacea5c4ce371ecabd31a0ec287ab27791cb25288d</span><br><span class="line">[root@node4 dockerfile]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE                                        COMMAND                  CREATED             STATUS                      PORTS                  NAMES</span><br><span class="line">9d8153320901        sunrisenan/httpd:test                        "httpd -D FOREGROUND"    33 seconds ago      Up 32 seconds               0.0.0.0:83-&gt;80/tcp     myhttpd</span><br></pre></td></tr></table></figure>

<ul>
<li>浏览器访问<a href="http://192.168.6.244:83/" target="_blank" rel="noopener">http://192.168.6.244:83</a></li>
</ul>
<img src = "/images/m_62579dbf724990c3a287eea1176ae4ae_r.png">

<h3 id="ENTRYPOINT指令"><a href="#ENTRYPOINT指令" class="headerlink" title="ENTRYPOINT指令"></a>ENTRYPOINT指令</h3><ul>
<li>Dockerfile</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vi /data/dockerfile/Dockerfile</span><br><span class="line"></span><br><span class="line">FROM centos:7</span><br><span class="line">ADD entrypoint.sh /entrypoint.sh</span><br><span class="line">RUN yum install epel-release -q -y &amp;&amp; yum install nginx -y</span><br><span class="line">ENTRYPOINT /entrypoint.sh</span><br></pre></td></tr></table></figure>

<ul>
<li>entrypoint.sh</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vi /data/dockerfile/entrypoint.sh</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">/sbin/nginx -g "daemon off;"</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong>entrypoint.sh不要忘了给执行权限！</p>
<ul>
<li>构建镜像</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 dockerfile]# docker build . -t sunrisenan/nginx:mynginx</span><br></pre></td></tr></table></figure>

<ul>
<li>运行镜像</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 dockerfile]# docker run -d --rm -p84:80 sunrisenan/nginx:mynginx </span><br><span class="line">c9b6f81b177022fe45d1eb14b6e20c02cf1a0307b648b35cc964f4c094512564</span><br><span class="line"></span><br><span class="line">[root@node4 dockerfile]# docker ps | grep mynginx</span><br><span class="line">c9b6f81b1770        sunrisenan/nginx:mynginx                     "/bin/sh -c /entrypo…"   36 seconds ago      Up 34 seconds       0.0.0.0:84-&gt;80/tcp     sweet_williams</span><br></pre></td></tr></table></figure>

<ul>
<li>浏览器访问<a href="http://192.168.6.244:84/" target="_blank" rel="noopener">http://192.168.6.244:84</a></li>
</ul>
<img src = "/images/m_d71e5344f6971fda8e4fb830628e9ed3_r.png">

<h1 id="Docker的网络模型"><a href="#Docker的网络模型" class="headerlink" title="Docker的网络模型"></a>Docker的网络模型</h1><h2 id="NAT-默认"><a href="#NAT-默认" class="headerlink" title="NAT(默认)"></a>NAT(默认)</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker run -ti --rm sunrisenan/alpine:3.10.3 /bin/sh</span><br><span class="line">/ # ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">100: eth0@if101: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue state UP </span><br><span class="line">    link/ether 02:42:ac:06:f4:02 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.6.244.2/24 brd 172.6.244.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<h2 id="None"><a href="#None" class="headerlink" title="None"></a>None</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker run -ti --rm --net=none  sunrisenan/alpine:3.10.3 /bin/sh</span><br><span class="line">/ # ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">/ #</span><br></pre></td></tr></table></figure>

<h2 id="Host"><a href="#Host" class="headerlink" title="Host"></a>Host</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker run -ti --rm --net=host sunrisenan/alpine:3.10.3 /bin/sh</span><br><span class="line">/ # ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens192: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP qlen 1000</span><br><span class="line">    link/ether 00:50:56:b3:4c:8f brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.6.244/24 brd 192.168.6.255 scope global ens192</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::250:56ff:feb3:4c8f/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN </span><br><span class="line">    link/ether 02:42:65:95:28:d8 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.6.244.1/24 brd 172.6.244.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:65ff:fe95:28d8/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">/ #</span><br></pre></td></tr></table></figure>

<h2 id="联合网络"><a href="#联合网络" class="headerlink" title="联合网络*"></a>联合网络*</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@node4 ~]# docker run -d sunrisenan/nginx:v1.12.2</span><br><span class="line">76f844e6057b6493a4a8933819ade7c29325ef17bc1fddc88bdf4c7ec60c620b</span><br><span class="line">[root@node4 ~]# </span><br><span class="line">[root@node4 ~]# docker ps -qa</span><br><span class="line">76f844e6057b</span><br><span class="line">[root@node4 ~]# docker run -ti --rm --net=container:76f844e6057b sunrisenan/nginx:curl bash</span><br><span class="line">root@76f844e6057b:/# curl localhost</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    body &#123;</span><br><span class="line">        width: 35em;</span><br><span class="line">        margin: 0 auto;</span><br><span class="line">        font-family: Tahoma, Verdana, Arial, sans-serif;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;For online documentation and support please refer to</span><br><span class="line">&lt;a href="http://nginx.org/"&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;</span><br><span class="line">Commercial support is available at</span><br><span class="line">&lt;a href="http://nginx.com/"&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">root@76f844e6057b:/#</span><br></pre></td></tr></table></figure>

<h1 id="额外一点内容"><a href="#额外一点内容" class="headerlink" title="额外一点内容"></a>额外一点内容</h1><h2 id="快速更改密码"><a href="#快速更改密码" class="headerlink" title="快速更改密码"></a>快速更改密码</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@shkf6-240 ~]# echo "1" |passwd root --stdin</span><br></pre></td></tr></table></figure>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">PhenoGao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://xonlab.com/2020/03/26/Docker%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%B1%87%E7%BC%96/">http://xonlab.com/2020/03/26/Docker%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%B1%87%E7%BC%96/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://xonlab.com" target="_blank">XonLab</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Docker/">Docker</a><a class="post-meta__tags" href="/tags/Kubernetes/">Kubernetes</a></div><div class="post_share"><div class="social-share" data-image="https://edu-102.oss-cn-beijing.aliyuncs.com/BlogPic/wallhaven-r2e58q.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/03/28/Kubernetes%E9%83%A8%E7%BD%B2%E2%85%A0/"><img class="prev-cover" data-src="https://edu-102.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%B0%81%E9%9D%A2/pexels-steve-johnson-1416367.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Kubernetes部署 Ⅰ</div></div></a></div><div class="next-post pull-right"><a href="/2020/03/22/%E3%80%8A%E5%B0%91%E6%9C%89%E4%BA%BA%E8%B5%B0%E7%9A%84%E8%B7%AF%E3%80%8B%E7%AC%AC4%E7%AB%A0/"><img class="next-cover" data-src="https://edu-102.oss-cn-beijing.aliyuncs.com/BlogPic/md-3.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">《少有人走的路》第4章</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/04/09/Kubernetes-Prometheus部署/" title="Kubernetes-Prometheus部署"><img class="relatedPosts_cover" data-src="https://edu-102.oss-cn-beijing.aliyuncs.com/de2a1ad249f7248d123b0a46d5faad9f.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-04-09</div><div class="relatedPosts_title">Kubernetes-Prometheus部署</div></div></a></div><div class="relatedPosts_item"><a href="/2020/04/15/Kubernetes-ELK部署/" title="Kubernetes-ELK部署"><img class="relatedPosts_cover" data-src="https://edu-102.oss-cn-beijing.aliyuncs.com/BlogPic/wallhaven-4gmmee.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-04-15</div><div class="relatedPosts_title">Kubernetes-ELK部署</div></div></a></div><div class="relatedPosts_item"><a href="/2020/04/03/Kubernetes-dubbo部署/" title="Kubernetes-dubbo部署"><img class="relatedPosts_cover" data-src="https://edu-102.oss-cn-beijing.aliyuncs.com/BlogPic/background-2731956_1280.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-04-03</div><div class="relatedPosts_title">Kubernetes-dubbo部署</div></div></a></div><div class="relatedPosts_item"><a href="/2020/04/04/Kubernetes-Apollo部署/" title="Kubernetes-apollo部署"><img class="relatedPosts_cover" data-src="https://edu-102.oss-cn-beijing.aliyuncs.com/BlogPic/material-design-hd-background-by-vactual-papers-wallpaper-695-1920x1080.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-04-04</div><div class="relatedPosts_title">Kubernetes-apollo部署</div></div></a></div><div class="relatedPosts_item"><a href="/2020/04/01/Kubernetes部署-Ⅱ/" title="Kubernetes部署 Ⅱ"><img class="relatedPosts_cover" data-src="https://edu-102.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%B0%81%E9%9D%A2/pexels-steve-johnson-1988692.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-04-01</div><div class="relatedPosts_title">Kubernetes部署 Ⅱ</div></div></a></div><div class="relatedPosts_item"><a href="/2020/03/28/Kubernetes部署Ⅰ/" title="Kubernetes部署 Ⅰ"><img class="relatedPosts_cover" data-src="https://edu-102.oss-cn-beijing.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%B0%81%E9%9D%A2/pexels-steve-johnson-1416367.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-03-28</div><div class="relatedPosts_title">Kubernetes部署 Ⅰ</div></div></a></div></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2021 By PhenoGao</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><button id="readmode" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font_plus" title="放大字体"><i class="fas fa-plus"></i></button><button id="font_minus" title="缩小字体"><i class="fas fa-minus"></i></button><button id="darkmode" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="/js/third-party/fireworks.js"></script><script id="ribbon_piao" mobile="true" src="/js/third-party/piao.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script></body></html>